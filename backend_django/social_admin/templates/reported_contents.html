<!DOCTYPE html>
<html lang="en">
<head>
{% load static %}
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Reported Contents & Messages</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/responsive.css' %}">

<style>
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #6366f1, #ec4899);
    color: white;
    margin: 0;
}

/* Navbar */
.navbar {
    display: flex;
    justify-content: flex-end;
    padding: 20px 40px;
}
.navbar a {
    color: white;
    text-decoration: none;
    font-weight: 600;
}

/* Container */
.container {
    width: 95%;
    max-width: 1500px;
    margin: 20px auto;
}

/* Header Box */
.header-box {
    background: rgba(255,255,255,0.15);
    padding: 18px 22px;
    border-radius: 16px;
    backdrop-filter: blur(12px);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-weight: 600;
}

/* Section */
.section {
    background: rgba(255,255,255,0.15);
    padding: 20px;
    border-radius: 18px;
    backdrop-filter: blur(12px);
    margin-bottom: 35px;
}

/* Search */
.search-form {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 12px;
}
.search-form input {
    padding: 8px 14px;
    border-radius: 10px;
    border: none;
    width: 260px;
}

/* Table */
table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    padding: 14px;
    text-align: center;
}
th {
    background: rgba(255,255,255,0.25);
}
tr:hover {
    background: rgba(255,255,255,0.25);
}

/* Actions */
.actions {
    display: flex;
    justify-content: center;
    gap: 8px;
}
.action-btn {
    padding: 6px 14px;
    border-radius: 20px;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
}
.view-btn { background: #38bdf8; color: black; }
.delete-btn { background: #f87171; color: black; }
.block-btn { background: #fb923c; color: black; }
.unblock-btn { background: #22c55e; color: black; }

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
}
.pagination a,
.pagination span {
    padding: 6px 12px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    color: white;
    text-decoration: none;
    font-weight: 600;
}
.pagination .current {
    background: white;
    color: black;
}
.pagination .disabled {
    opacity: 0.4;
    pointer-events: none;
}

/* Modal */
.modal {
    display: none; 
    position: fixed; 
    z-index: 1000; 
    padding-top: 120px; 
    left: 0; top: 0; width: 100%; height: 100%;
    overflow: auto; background-color: rgba(0,0,0,0.5);
}
.modal-content {
    background-color: #1f2937; 
    margin: auto; padding: 20px; border-radius: 12px;
    width: 360px; text-align: center;
    color: white;
}
.modal-content button {
    margin: 10px; padding: 8px 16px; border-radius: 10px;
    border: none; font-weight: 600; cursor: pointer;
}
.confirm-btn { background: #f87171; color: black; }
.cancel-btn { background: #38bdf8; color: black; }
</style>
</head>

<body>

<!-- Navbar -->
<div class="navbar">
    <a href="{% url 'admin_dashboard' %}">Home</a>
</div>

<div class="container">

    <!-- ================= REPORTED CONTENTS ================= -->
    <div class="header-box">
        <h2 style="margin:0;">ðŸš© Reported Contents</h2>
        <span>Total Reported: {{ total_contents }}</span>
    </div>

    <form method="get" class="search-form">
        <input type="text" name="content_q" placeholder="Search reported contents..." value="{{ content_query }}">
    </form>

    <div class="section">
        <div class="table-responsive">
        <table>
            <tr>
                <th>Sl No.</th>
                <th>Content ID</th>
                <th>Type</th>
                <th>Reported Against</th>
                <th>Reported By</th>
                <th>Reason</th>
                <th>Action</th>
            </tr>

            {% for r in contents_page %}
            <tr>
                <td>{{ forloop.counter0|add:contents_page.start_index }}</td>
                <td>{{ r.object_id }}</td>
                <td>
                    {% if r.content_type.model == "post" %}
                        Post
                    {% elif r.content_type.model == "comment" %}
                        Comment
                    {% else %}
                        Unknown
                    {% endif %}
                </td>
                <td>
                    {% if r.content_type.model == "post" and r.content_object and r.content_object.postedby %}
                        {{ r.content_object.postedby.name }}
                    {% elif r.content_type.model == "comment" and r.content_object and r.content_object.user %}
                        {{ r.content_object.user.name }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ r.reported_by.name }}</td>
                <td>{{ r.reason }}</td>
                <td>
                    <div class="actions">
                        <!-- VIEW -->
                        {% if r.content_type.model == "post" %}
                        <a href="{% url 'post_detail' r.object_id %}" class="action-btn view-btn">View</a>
                        {% elif r.content_type.model == "comment" %}
                        <a href="{% url 'comment_management' %}?comment_id={{ r.object_id }}" class="action-btn view-btn">View</a>
                        {% endif %}

                        <!-- DELETE -->
                        <button class="action-btn delete-btn" onclick="openModal('{{ r.id }}'); return false;">Delete</button>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="6">No reported contents found</td></tr>
            {% endfor %}
        </table>

        <!-- Pagination -->
        <div class="pagination">
            {% if contents_page.has_previous %}
                <a href="?content_page={{ contents_page.previous_page_number }}&content_q={{ content_query }}">â€¹</a>
            {% else %}<span class="disabled">â€¹</span>{% endif %}
            {% for num in contents_page.paginator.page_range %}
                {% if num == contents_page.number %}
                    <span class="current">{{ num }}</span>
                {% elif num >= contents_page.number|add:'-2' and num <= contents_page.number|add:'2' %}
                    <a href="?content_page={{ num }}&content_q={{ content_query }}">{{ num }}</a>
                {% endif %}
            {% endfor %}
            {% if contents_page.has_next %}
                <a href="?content_page={{ contents_page.next_page_number }}&content_q={{ content_query }}">â€º</a>
            {% else %}<span class="disabled">â€º</span>{% endif %}
        </div>
    </div>

    <!-- ================= REPORTED MESSAGES ================= -->
    <div class="header-box">
        <h2 style="margin:0;">ðŸ“© Reported Messages</h2>
        <span>Total Reported: {{ total_messages }}</span>
    </div>

    <form method="get" class="search-form">
        <input type="text" name="msg_q" placeholder="Search reported messages..." value="{{ msg_query }}">
    </form>

    <div class="section">
        <div class="table-responsive">
        <table>
            <tr>
                <th>Sl No.</th>
                <th>Reported Against</th>
                <th>Reported By</th>
                <th>Reason</th>
                <th>Action</th>
            </tr>

            {% for r in messages_page %}
            <tr>
                <td>{{ forloop.counter0|add:messages_page.start_index }}</td>
                <td>{% if r.content_object and r.content_object.sender %}{{ r.content_object.sender.name }}{% else %}N/A{% endif %}</td>
                <td>{{ r.reported_by.name }}</td>
                <td>{{ r.reason }}</td>
                <td>
                    <div class="actions">
                        {% if not r.reported_by.is_active %}
                        <form method="post" style="display:inline;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="unblock_user">
                            <input type="hidden" name="user_id" value="{{ r.reported_by.id }}">
                            <button type="submit" class="action-btn unblock-btn">Unblock</button>
                        </form>
                        {% else %}
                        <form method="post" style="display:inline;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="block_user">
                            <input type="hidden" name="user_id" value="{{ r.reported_by.id }}">
                            <button type="submit" class="action-btn block-btn">Block</button>
                        </form>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="4">No reported messages found</td></tr>
            {% endfor %}
        </table>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            {% if messages_page.has_previous %}
                <a href="?msg_page={{ messages_page.previous_page_number }}&msg_q={{ msg_query }}">â€¹</a>
            {% else %}<span class="disabled">â€¹</span>{% endif %}
            {% for num in messages_page.paginator.page_range %}
                {% if num == messages_page.number %}
                    <span class="current">{{ num }}</span>
                {% elif num >= messages_page.number|add:'-2' and num <= messages_page.number|add:'2' %}
                    <a href="?msg_page={{ num }}&msg_q={{ msg_query }}">{{ num }}</a>
                {% endif %}
            {% endfor %}
            {% if messages_page.has_next %}
                <a href="?msg_page={{ messages_page.next_page_number }}&msg_q={{ msg_query }}">â€º</a>
            {% else %}<span class="disabled">â€º</span>{% endif %}
        </div>
    </div>

</div>

<!-- DELETE CONFIRMATION MODAL -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h3>Are you sure you want to delete this?</h3>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" id="report_id" name="report_id" value="">
            <input type="hidden" name="action" value="delete_content">
            <button type="submit" class="confirm-btn">Delete</button>
            <button type="button" class="cancel-btn" onclick="closeModal();">Cancel</button>
        </form>
    </div>
</div>

<script>
function openModal(reportId){
    document.getElementById('report_id').value = reportId;
    document.getElementById('deleteModal').style.display = 'block';
}
function closeModal(){
    document.getElementById('deleteModal').style.display = 'none';
}
</script>

</body>
</html>
